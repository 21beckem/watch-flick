<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gyroscope / Accelerometer Test</title>
    <script src="https://unpkg.com/playroomkit/multiplayer.full.umd.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Gyroscope</h1>
    <canvas id="GyroChart"></canvas>
    <h1>Acelerometer</h1>
    <canvas id="AcelChart"></canvas>
    <script>
const dataLengthLimit = 300;
const gyroCanvas = document.getElementById('GyroChart');
const acelCanvas = document.getElementById('AcelChart');
gyroCanvas.height = 75;
acelCanvas.height = 75;
const gyroChart = new Chart(
    gyroCanvas,
    {
        type: 'line',
        data: {
            labels: new Array(dataLengthLimit).fill(''),
            datasets: [
                {
                    label: 'X',
                    backgroundColor: 'rgb(255, 0, 0)',
                    borderColor: 'rgb(255, 0, 0)',
                    pointRadius : 0,
                    data: new Array(dataLengthLimit).fill(undefined),
                },
                {
                    label: 'Y',
                    backgroundColor: 'rgb(0, 255, 0)',
                    borderColor: 'rgb(0, 255, 0)',
                    pointRadius : 0,
                    data: new Array(dataLengthLimit).fill(undefined),
                },
                {
                    label: 'Z',
                    backgroundColor: 'rgb(0, 0, 255)',
                    borderColor: 'rgb(0, 0, 255)',
                    pointRadius : 0,
                    data: new Array(dataLengthLimit).fill(undefined),
                }
            ]
        },
        options: { animation: {duration: 0} }
    }
);
const acelChart = new Chart(
    acelCanvas,
    {
        type: 'line',
        data: {
            labels: new Array(dataLengthLimit).fill(''),
            datasets: [
                {
                    label: 'X',
                    backgroundColor: 'rgb(255, 0, 0)',
                    borderColor: 'rgb(255, 0, 0)',
                    pointRadius : 0,
                    data: new Array(dataLengthLimit).fill(undefined),
                },
                {
                    label: 'Y',
                    backgroundColor: 'rgb(0, 255, 0)',
                    borderColor: 'rgb(0, 255, 0)',
                    pointRadius : 0,
                    data: new Array(dataLengthLimit).fill(undefined),
                },
                {
                    label: 'Z',
                    backgroundColor: 'rgb(0, 0, 255)',
                    borderColor: 'rgb(0, 0, 255)',
                    pointRadius : 0,
                    data: new Array(dataLengthLimit).fill(undefined),
                }
            ]
        },
        options: { animation: {duration: 0} }
    }
);
// function to update the chart 
function addData(chart, dataX, dataY, dataZ) {
    chart.data.labels.push('');
    chart.data.datasets[0].data.push(dataX);
    chart.data.datasets[1].data.push(dataY);
    chart.data.datasets[2].data.push(dataZ);
    chart.update();
    if (chart.data.labels.length > dataLengthLimit) {
        chart.data.labels.splice(0, 1);
        chart.data.datasets[0].data.splice(0, 1);
        chart.data.datasets[1].data.splice(0, 1);
        chart.data.datasets[2].data.splice(0, 1);
    }
}
async function joinHostedData() {
    const code = prompt('Enter Room Code');
    await Playroom.insertCoin({
        skipLobby: true,
        roomCode: code
    }, () => {
        startReading();
    });
}
function startReading() {
    setInterval(() => {
        const gyro = Playroom.getState('gyro');
        addData(gyroChart, gyro.x, gyro.y, gyro.z);
    }, 50);
    
    setInterval(() => {
        const acel = Playroom.getState('acel');
        addData(acelChart, acel.x, acel.y, acel.z);
    }, 50);
}
joinHostedData();
    </script>
</body>
</html>